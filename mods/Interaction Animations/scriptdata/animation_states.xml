<?xml version="1.0"?>
<tweaks>
	<tweak version="2" name="anims/fps/fps_spawn" extension="animation_states">
		<search>
			<xml/>
			<state name="fps"/>
		</search>

		<target>
			<to name="interact" redirect="fps/interact_instant"/>
			<to name="interact_enter" redirect="fps/interact_enter"/>
			<to name="interact_hold" redirect="fps/interact_hold"/>
			<to name="interact_exit" redirect="fps/interact_exit"/>
			<to name="interact_interupt" redirect="fps/interact_interupt"/>
		</target>
	</tweak>
	
	<tweak version="2" name="anims/fps/fps_spawn" extension="animation_states">
		<search>
			<xml/>
		</search>

		<target>
			<state name="fps/interact_enter" type="mix" segment="base" speed="1.0"> 
				<!-- Timed interactions begin with these animations. They should then transition seamlessly to fps/interact_hold animations.-->
				<anim name="fix_drill_enter" weight="fix_drill"/>
				<anim name="answer_radio_enter" weight="answer_radio"/>
				<anim name="lockpick_enter" weight="lockpick"/>
				
				<keys>
					<key at="trigger" trigger="foley_flap_heavy_equipment" callback="play_sound" class_name="base" param1="foley_flap_heavy_equipment"/>
					<key at="trigger" trigger="wp_foley_generic_back_in_hand" callback="play_sound" class_name="base" param1="wp_foley_generic_back_in_hand"/>
					<key at="trigger" trigger="wp_foley_generic_tilt" callback="play_sound" class_name="base" param1="wp_foley_generic_tilt"/>
				
					<key at="enter" callback="spawn_interaction_items" class_name="base"/>
				</keys>
				
				<exit name="fps/interact_hold"/>
			</state>
			
			<state name="fps/interact_hold" type="mixloop" segment="base" speed="1.0"> 
				<!-- Animations that play for as long as the interaction. -->
				<from_group name="fps/interact_enter" blend="5"/>
				<default blend="0"/>
				
				<anim name="fix_drill_loop" weight="fix_drill"/>
				<anim name="answer_radio_loop" weight="answer_radio"/>
				<anim name="lockpick_loop" weight="lockpick"/>
				
				<keys>
					<key at="enter" callback="anim_clbk_interact_hold_enter" class_name="base"/>
					<key at="loop" callback="anim_clbk_interact_hold_loop" class_name="base"/>
					<key at="exit" callback="anim_clbk_interact_hold_exit" class_name="base"/>
				</keys>
			</state>
			
			<state name="fps/interact_exit" type="mix" segment="base" speed="1.0">
				<!-- When the interactions are close to finishing, this state will play. -->
				<from_group name="fps/interact_hold" blend="5"/>
				<default blend="5"/>
				
				<anim name="fix_drill_exit" weight="fix_drill"/>
				<anim name="answer_radio_exit" weight="answer_radio"/>
				<anim name="lockpick_exit" weight="lockpick"/>
				
				<keys>
					<key at="trigger" trigger="wp_foley_generic_tilt" callback="play_sound" class_name="base" param1="wp_foley_generic_tilt"/>
					
					<key at="exit" callback="anim_clbk_unspawn_interaction_items" class_name="base"/>
				</keys>
			</state>
			
			<state name="fps/interact_interupt" type="mix" segment="base" speed="2.0"> 
				<!-- If timed interactions are interupted (meaning fps/interaction_hold should be stopped prematurely,
					 such as when cancelling or playing with bots and their reduced interaction time), exit animations 
					 will play at a higher speed, then the gun will be equipped as per vanilla gameplay. 
				-->
				<from_group name="fps/interact_hold" blend="5"/>
				<default blend="5"/>
				
				<anim name="fix_drill_exit" weight="fix_drill"/>
				<anim name="answer_radio_exit" weight="answer_radio"/>
				<anim name="lockpick_exit" weight="lockpick"/>
				
				<keys>
					<key at="trigger" trigger="wp_foley_generic_tilt" callback="play_sound" class_name="base" param1="wp_foley_generic_tilt"/>
					
					<key at="enter" callback="anim_clbk_interact_interupt_enter" class_name="base"/>
					<key at="exit" callback="anim_clbk_unspawn_interaction_items" class_name="base"/>
					<key at="exit" callback="anim_clbk_interact_interupt_exit" class_name="base"/>
					<key at="exit" callback="anim_clbk_play_weapon_anim" class_name="base" param1="equip"/>
				</keys>
				
				<exit name="fps/equip"/>
			</state>
			
			<state name="fps/interact_instant" type="mix" segment="base" speed="1.0"> 
				<!-- Interactions with no timers (loose loot, pickups, etc) consist of a single animation, preferably as
					 short as possible, that can be cancelled by running, shooting, meleeing, etc.
				-->
				<anim name="insert_keycard" weight="insert_keycard"/>
				<anim name="grab" weight="grab"/>
				
				<keys>
					<key at="enter" callback="spawn_interaction_items" class_name="base"/>
					<key at="exit" callback="anim_clbk_interact_instant_exit" class_name="base"/>
					<key at="exit" callback="anim_clbk_play_weapon_anim" class_name="base" param1="equip"/>
					<key at="exit" callback="anim_clbk_unspawn_interaction_items" class_name="base"/>
				</keys>
				
				<exit name="fps/equip"/>
			</state>
		</target>
	</tweak>
</tweaks>
